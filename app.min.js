'use strict';const express=require("express"),app=express(),port=process.env.PORT||8989,handlebars=require("express-handlebars"),Handlebars=require("Handlebars"),path=require("path"),bodyParser=require("body-parser"),{allowInsecurePrototypeAccess}=require("@handlebars/allow-prototype-access"),http=require("http").Server(app),io=require("socket.io")(http),mongoose=require("mongoose"),mongoDBURI="mongodb://localhost:27017/nodeMsg";
mongoose.connect(mongoDBURI,{useNewUrlParser:!0,useUnifiedTopology:!0}).then(a=>{console.log("connected to mongodb...")}).catch(a=>{console.log(`Error ${a}`)});app.use(express.static(path.join(__dirname,"public")));app.engine("handlebars",handlebars({defaultLayout:"home",helpers:{},partialsDir:path.join(__dirname,"views/layouts/partials"),handlebars:allowInsecurePrototypeAccess(Handlebars)}));app.use(bodyParser.json());app.use(bodyParser.urlencoded({extended:!0}));app.set("view engine","handlebars");
const home=require("./route/home");app.use("/",home);io.on("connection",a=>{console.log("User connected....")});http.listen(port,()=>{console.log(`Listening to port ${port}`)});